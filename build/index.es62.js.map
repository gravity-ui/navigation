{"version":3,"file":"index.es62.js","sources":["../src/components/Settings/SettingsMenu/SettingsMenu.tsx"],"sourcesContent":["import React from 'react';\n\nimport {Icon} from '@gravity-ui/uikit';\n\nimport {block} from '../../utils/cn';\nimport {useCurrent, useStableCallback} from '../helpers';\nimport {Item, SettingsMenuProps} from '../types';\n\nimport './SettingsMenu.scss';\n\nconst b = block('settings-menu');\n\nexport interface SettingsMenuInstance {\n    handleKeyDown(event: React.KeyboardEvent): boolean;\n    clearFocus(): void;\n}\n\nexport const SettingsMenu = React.forwardRef<SettingsMenuInstance, SettingsMenuProps>(\n    // eslint-disable-next-line prefer-arrow-callback\n    function SettingsMenu({items, onChange, activeItemId}, ref) {\n        const [focusItemId, setFocusId] = React.useState<string>();\n        const containerRef = React.useRef<HTMLDivElement>(null);\n        const handleChange = useStableCallback(onChange);\n        const getFocused = useCurrent(focusItemId);\n\n        React.useImperativeHandle(\n            ref,\n            () => ({\n                handleKeyDown(event) {\n                    if (!containerRef.current) {\n                        return false;\n                    }\n                    const focused = getFocused();\n                    if (focused && event.key === 'Enter') {\n                        handleChange(focused);\n                        return true;\n                    } else if (event.key === 'ArrowDown') {\n                        setFocusId(focusNext(containerRef.current, focused, 1));\n                        return true;\n                    } else if (event.key === 'ArrowUp') {\n                        setFocusId(focusNext(containerRef.current, focused, -1));\n                        return true;\n                    }\n                    return false;\n                },\n                clearFocus() {\n                    setFocusId(undefined);\n                },\n            }),\n            [getFocused, handleChange],\n        );\n\n        return (\n            <div ref={containerRef} className={b()}>\n                {items.map((firstLevelItem) => {\n                    if ('groupTitle' in firstLevelItem) {\n                        return (\n                            <div key={firstLevelItem.groupTitle} className={b('group')}>\n                                <span className={b('group-heading')}>\n                                    {firstLevelItem.groupTitle}\n                                </span>\n                                {firstLevelItem.items.map((item) => {\n                                    return renderMenuItem(\n                                        item,\n                                        onChange,\n                                        activeItemId,\n                                        focusItemId,\n                                    );\n                                })}\n                            </div>\n                        );\n                    }\n                    return renderMenuItem(firstLevelItem, onChange, activeItemId, focusItemId);\n                })}\n            </div>\n        );\n    },\n);\n\nfunction renderMenuItem(\n    item: Item,\n    onChange: (id: string) => void,\n    activeItemId: string | undefined,\n    focusItemId: string | undefined,\n) {\n    return (\n        <span\n            key={item.title}\n            className={b('item', {\n                selected: activeItemId === item.id,\n                disabled: item.disabled,\n                focused: focusItemId === item.id,\n                badge: item.withBadge,\n            })}\n            onClick={() => {\n                if (!item.disabled) {\n                    onChange(item.id);\n                }\n            }}\n            data-id={item.id}\n        >\n            {item.icon ? <Icon size={16} {...item.icon} className={b('item-icon')} /> : undefined}\n            <span>{item.title}</span>\n        </span>\n    );\n}\n\nfunction focusNext(container: HTMLElement, focused: string | undefined, direction: number) {\n    const elements = container.querySelectorAll(`.${b('item')}:not(.${b('item')}_disabled)`);\n    if (elements.length === 0) {\n        return undefined;\n    }\n\n    let currentIndex = direction > 0 ? -1 : 0;\n    if (focused) {\n        currentIndex = Array.prototype.findIndex.call(\n            elements,\n            (element) => element.getAttribute('data-id') === focused,\n        );\n    }\n\n    currentIndex = (elements.length + currentIndex + direction) % elements.length;\n    return elements[currentIndex].getAttribute('data-id') ?? undefined;\n}\n"],"names":["React","SettingsMenu"],"mappings":"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"}