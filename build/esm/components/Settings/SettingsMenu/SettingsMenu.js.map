{"version":3,"file":"SettingsMenu.js","sources":["../../../../../../src/components/Settings/SettingsMenu/SettingsMenu.tsx"],"sourcesContent":["import React from 'react';\n\nimport {Icon} from '@gravity-ui/uikit';\n\nimport {block} from '../../utils/cn';\nimport {useCurrent, useStableCallback} from '../helpers';\nimport {Item, SettingsMenuProps} from '../types';\n\nimport './SettingsMenu.scss';\n\nconst b = block('settings-menu');\n\nexport interface SettingsMenuInstance {\n    handleKeyDown(event: React.KeyboardEvent): boolean;\n    clearFocus(): void;\n}\n\nexport const SettingsMenu = React.forwardRef<SettingsMenuInstance, SettingsMenuProps>(\n    // eslint-disable-next-line prefer-arrow-callback\n    function SettingsMenu({items, onChange, activeItemId}, ref) {\n        const [focusItemId, setFocusId] = React.useState<string>();\n        const containerRef = React.useRef<HTMLDivElement>(null);\n        const handleChange = useStableCallback(onChange);\n        const getFocused = useCurrent(focusItemId);\n\n        React.useImperativeHandle(\n            ref,\n            () => ({\n                handleKeyDown(event) {\n                    if (!containerRef.current) {\n                        return false;\n                    }\n                    const focused = getFocused();\n                    if (focused && event.key === 'Enter') {\n                        handleChange(focused);\n                        return true;\n                    } else if (event.key === 'ArrowDown') {\n                        setFocusId(focusNext(containerRef.current, focused, 1));\n                        return true;\n                    } else if (event.key === 'ArrowUp') {\n                        setFocusId(focusNext(containerRef.current, focused, -1));\n                        return true;\n                    }\n                    return false;\n                },\n                clearFocus() {\n                    setFocusId(undefined);\n                },\n            }),\n            [getFocused, handleChange],\n        );\n\n        return (\n            <div ref={containerRef} className={b()}>\n                {items.map((firstLevelItem) => {\n                    if ('groupTitle' in firstLevelItem) {\n                        return (\n                            <div key={firstLevelItem.groupTitle} className={b('group')}>\n                                <span className={b('group-heading')}>\n                                    {firstLevelItem.groupTitle}\n                                </span>\n                                {firstLevelItem.items.map((item) => {\n                                    return renderMenuItem(\n                                        item,\n                                        onChange,\n                                        activeItemId,\n                                        focusItemId,\n                                    );\n                                })}\n                            </div>\n                        );\n                    }\n                    return renderMenuItem(firstLevelItem, onChange, activeItemId, focusItemId);\n                })}\n            </div>\n        );\n    },\n);\n\nfunction renderMenuItem(\n    item: Item,\n    onChange: (id: string) => void,\n    activeItemId: string | undefined,\n    focusItemId: string | undefined,\n) {\n    return (\n        <span\n            key={item.title}\n            className={b('item', {\n                selected: activeItemId === item.id,\n                disabled: item.disabled,\n                focused: focusItemId === item.id,\n                badge: item.withBadge,\n            })}\n            onClick={() => {\n                if (!item.disabled) {\n                    onChange(item.id);\n                }\n            }}\n            data-id={item.id}\n        >\n            {item.icon ? <Icon size={16} {...item.icon} className={b('item-icon')} /> : undefined}\n            <span>{item.title}</span>\n        </span>\n    );\n}\n\nfunction focusNext(container: HTMLElement, focused: string | undefined, direction: number) {\n    const elements = container.querySelectorAll(`.${b('item')}:not(.${b('item')}_disabled)`);\n    if (elements.length === 0) {\n        return undefined;\n    }\n\n    let currentIndex = direction > 0 ? -1 : 0;\n    if (focused) {\n        currentIndex = Array.prototype.findIndex.call(\n            elements,\n            (element) => element.getAttribute('data-id') === focused,\n        );\n    }\n\n    currentIndex = (elements.length + currentIndex + direction) % elements.length;\n    return elements[currentIndex].getAttribute('data-id') ?? undefined;\n}\n"],"names":["React"],"mappings":"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"}